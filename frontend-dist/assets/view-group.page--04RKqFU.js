import{r,j as e}from"./markdown-Qw4Jt3t5.js";import{j as A,aN as ve,s as M,B as a,y as w,aO as ye,u as S,aP as Ce,am as Ne,h as Se,D as W,I as Y,e as be,i as De,k as Te,V as Ae,ab as ke,aQ as Be,S as Oe,l as Pe,aR as $,aS as _,N as q,f as Le,a4 as Re,ad as Fe,_ as N,aT as Ue}from"./index-2Mm0dNtt.js";import{c as Je}from"./coverImageCamera-M_j72FHK.js";import{M as k}from"./modal.component-cjgN5hw1.js";import{p as K}from"./profileUrlBuilder-lYjeV696.js";import{u as ze,O as He}from"./uploadImage.hook-2i8OurMw.js";import{P as Ve,G as Qe,a as We,b as Ye,c as $e,d as _e,L as qe,e as X,f as Z,E as ee,g as se,R as Ke,S as te,h as ie}from"./view-group.styles-nQqXY7f-.js";import"./calendar-TeNl4l8Y.js";import"./index.esm-VMS9YxoW.js";const Xe=({showModal:u,setShowModal:i,id:p})=>{const o=A(),[c,{isLoading:h,isSuccess:n}]=ve(),m=async()=>{try{await c(p).unwrap(),i(!1),o("/app/groups")}catch{w("Error occurred while deleting the group")}};return r.useEffect(()=>{n&&M("Exit the group successfully!")},[n]),e.jsx(k,{isOpen:u,setIsOpen:i,width:"lg",title:"Are you sure you want to delete this group?",children:e.jsx("div",{className:"flex flex-col gap-8",children:e.jsxs("div",{className:"flex gap-4 flex-row-reverse",children:[e.jsx(a,{className:"!px-8",select:"danger",outline:!0,loading:h,onClick:m,children:"Yes"}),e.jsx(a,{className:"!px-6",onClick:()=>i(!1),children:"Cancel"})]})})})},Ze=({showModal:u,setShowModal:i,id:p})=>{const[o,{isSuccess:c,isLoading:h,reset:n}]=ye(),m=async()=>{try{await o(p).unwrap(),i(!1)}catch{w("Error occurred while exiting the group"),n()}};return r.useEffect(()=>{c&&M("Exit the group successfully!")},[c]),e.jsx(k,{isOpen:u,setIsOpen:i,title:"Are you sure you want to exit this group?",width:"lg",children:e.jsxs("div",{className:"flex gap-4 flex-row-reverse",children:[e.jsx(a,{className:"!px-8",select:"danger",outline:!0,loading:h,onClick:m,children:"Yes"}),e.jsx(a,{className:"!px-6",onClick:()=>i(!1),children:"Cancel"})]})})},es=S.p`
    margin: 0 !important;
    font-size: 0.8rem;
    max-width: 10ch;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
`,ss=S.div`
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 12px;
    gap: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease-in-out;
    min-width: 7.4rem;
    &:hover {
        background: var(--indigo-50);
        border-radius: 6px;
    }
`,ts=S.img`
    height: 70px;
    width: 70px;
    border-radius: 50%;
    object-fit: cover;
`,is=S.div`
    position: absolute;
    top: 0;
    right: 10%;
`,re=({ID:u,ProfileImage:i,FullName:p,Username:o,Type:c,Admin:h,GroupID:n,IsMe:m,Owner:g})=>{const l=A(),[E]=Ce(),f=async()=>{try{n&&(await E({id:n,ID:u,Type:c==="MEMBER"?"ADMIN":"MEMBER"}).unwrap(),M("Changed the permission successfully!"))}catch{w("Error occurred while giving permission!")}},v=[{option:c=="MEMBER"?"Add an admin":"Dismiss an admin",handler:()=>{f()}},{option:"View Profile",handler:()=>{l(K(o))}}],j=[{option:"View Profile",handler:()=>{l(K(o))}}];return e.jsxs(ss,{children:[g?e.jsx(is,{children:e.jsx(Ne,{size:18,color:"#FFBB48"})}):e.jsx(e.Fragment,{}),e.jsx(ts,{alt:"",src:i??Se}),e.jsxs("span",{className:"flex flex-row items-center gap-2 relative",children:[e.jsx(es,{title:p,children:p}),m?e.jsx(e.Fragment,{}):h&&!g?e.jsx(e.Fragment,{children:e.jsx(W,{options:v,right:"10%",top:"100%",left:"auto",bottom:"auto",menuWidth:"10rem",children:e.jsx(Y,{})})}):e.jsx(e.Fragment,{children:e.jsx(W,{options:j,right:"10%",top:"100%",left:"auto",bottom:"auto",menuWidth:"10rem",children:e.jsx(Y,{})})})]})]})},xs=()=>{var R,F,U,J,z,H;const u=A(),[i,p]=r.useState(!1),[o,c]=r.useState(!1),[h,n]=r.useState(!1),[m,g]=r.useState(!1),[l,E]=r.useState([""]),[f,v]=r.useState(""),[j,G]=r.useState(""),y=be(t=>t.auth.user),{id:x}=De(),{data:b,isSuccess:B}=Te(+x),{data:D}=Ae(),s=b==null?void 0:b.data[0],oe=((R=s==null?void 0:s.GroupMembers)==null?void 0:R.filter(t=>t.Type==="ADMIN"))??[],ne=((F=s==null?void 0:s.GroupMembers)==null?void 0:F.filter(t=>t.Type==="MEMBER"))??[],d=((J=(U=s==null?void 0:s.GroupMembers)==null?void 0:U.find(t=>t.ID===y.ID))==null?void 0:J.Type)||"NOTHING",ae=()=>{g(t=>!t)},ce=()=>{n(t=>!t)},[le,{isSuccess:O,isLoading:de}]=ke(),ue=async()=>{try{await le(x).unwrap(),u(`/app/chat-room/${x}`)}catch{w("Error occurred while joining the group")}},[pe,{isSuccess:P,isLoading:L,reset:xe}]=Be(),T=async()=>{try{const t=JSON.stringify(s==null?void 0:s.GroupTags)!==JSON.stringify(l),V=(s==null?void 0:s.GroupDescription)!==f,Q=(s==null?void 0:s.GroupCoverImage)!==j,I={id:s.ID};if(V&&(I.GroupDescription=f),t&&(N.difference(l,s.GroupTags).length!==0&&(I.AddedGroupTags=N.difference(l,s.GroupTags)),N.difference(s.GroupTags,l).length!==0&&(I.RemovedGroupTags=N.difference(s.GroupTags,l))),Q){const Ee=await me(j);I.GroupCoverImageUrl=Ee,C(!1)}(V||t||Q)&&await pe(I).unwrap()}catch{w("Error occurred while updating!"),xe()}},{isLoading:he,trigger:me}=ze(),[ge,C]=r.useState(!1),fe=()=>{C(t=>!t)},je=e.jsxs(k,{className:"flex flex-col gap-4",isOpen:ge,setIsOpen:C,width:"lg",title:"Edit Cover Image",children:[e.jsx(He,{height:"280px",value:j,onChange:t=>G(t),radius:"5px"}),e.jsxs("div",{className:"flex flex-row justify-end pt-6 items-center gap-2",children:[e.jsx(a,{select:"primary",loading:he,onClick:T,children:"Apply"}),e.jsx(a,{select:"danger",onClick:()=>{G(s.GroupCoverImage),C(!1)},outline:!0,className:"!border-transparent",children:"Cancel"})]})]});r.useEffect(()=>{E(s==null?void 0:s.GroupTags),v(s==null?void 0:s.GroupDescription),G(s==null?void 0:s.GroupCoverImage)},[B]),r.useEffect(()=>{O&&M("Joined the group successfully!"),P&&M("Updated the group successfully!")},[O,P]);const Ge=e.jsx(a,{select:"secondary",title:"Go to chat room",className:"!absolute bottom-8 right-8",onClick:()=>u(`/app/chat-room/${x}`),children:e.jsx(Ue,{size:24})}),Ie=e.jsx(a,{select:"danger",outline:!0,onClick:ae,children:"Delete Group"}),Me=e.jsx(a,{select:"danger",outline:!0,onClick:ce,children:"Exit Group"}),we=e.jsx(a,{select:"secondary",title:"Join",className:"absolute bottom-8 right-8 px-4",loading:de,onClick:ue,children:"Join"});return B?e.jsxs(Ve,{...Pe,children:[e.jsxs(Qe,{children:[e.jsx(We,{src:j}),d==="ADMIN"&&e.jsx(Ye,{src:Je,title:"Edit cover image",onClick:fe}),e.jsxs($e,{children:[e.jsx("h1",{className:"lg:text-5xl text-3xl text-white font-bold",children:s==null?void 0:s.GroupTitle}),e.jsx("p",{className:"lg:text-2xl text-md text-white ml-2",children:((z=s==null?void 0:s.GroupMembers)==null?void 0:z.length)+" Members"})]}),d==="ADMIN"||d==="MEMBER"?Ge:we]}),e.jsxs(_e,{children:[e.jsxs(qe,{children:[e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx("h2",{children:"Description"}),e.jsx(ee,{title:"Edit",onClick:()=>{c(!o)},children:d==="ADMIN"?L?e.jsx($,{className:"animate-spin"}):o?e.jsx(_,{onClick:T,size:24}):e.jsx(q,{size:24}):e.jsx(e.Fragment,{})})]}),e.jsx(se,{children:o?e.jsx(Le,{value:f,onChange:t=>v(t.target.value),multiline:!0,limit:512,maxLength:512,rows:5}):e.jsxs(e.Fragment,{children:[" ",f," "]})})]}),e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx("h2",{children:"Interest"}),e.jsx(ee,{title:"Edit",onClick:()=>p(!i),children:d==="ADMIN"?L?e.jsx($,{className:"animate-spin"}):i?e.jsx(_,{onClick:T,size:24}):e.jsx(q,{size:24}):e.jsx(e.Fragment,{})})]}),e.jsx(se,{children:i?e.jsx(Re,{updateSelectedTags:t=>E(t),availableTags:D==null?void 0:D.data,selectedTags:l}):e.jsx(e.Fragment,{children:(H=s==null?void 0:s.GroupTags)==null?void 0:H.map(t=>e.jsx(Fe,{text:t,size:"sm"}))})})]}),e.jsx("div",{className:"flex gap-2 items-end mt-auto",children:y.ID===s.GroupOwner.ID?Ie:d==="MEMBER"||d==="ADMIN"?Me:e.jsx(e.Fragment,{})})]}),e.jsxs(Ke,{children:[e.jsx(te,{children:"ADMINS"}),e.jsx(ie,{children:oe.map(t=>e.jsx(re,{Admin:d==="ADMIN",IsMe:t.ID===y.ID,Owner:t.ID===s.GroupOwner.ID,GroupID:x,...t}))}),e.jsx("br",{}),e.jsx(te,{children:"MEMBERS"}),e.jsx(ie,{children:ne.map(t=>e.jsx(re,{IsMe:t.ID===y.ID,Admin:d==="ADMIN",GroupID:x,...t}))})]})]}),e.jsx(Xe,{id:x,showModal:m,setShowModal:g}),e.jsx(Ze,{id:x,showModal:h,setShowModal:n}),je]}):e.jsx(Oe,{})};export{xs as default};
